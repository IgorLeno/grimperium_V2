[tox]
envlist = py39,py310,py311,py312,lint,typecheck
isolated_build = true
skip_missing_interpreters = true

[testenv]
description = Run tests with pytest
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
    pytest-xdist>=3.3.0
commands =
    pytest {posargs:tests/} --cov=src/grimperium --cov-report=term-missing

[testenv:lint]
description = Run linting with ruff and black
skip_install = true
deps =
    ruff>=0.1.0
    black>=23.9.0
commands =
    ruff check src/ tests/
    black --check src/ tests/

[testenv:typecheck]
description = Run type checking with mypy
deps =
    mypy>=1.5.0
    pandas-stubs
    types-requests
commands =
    mypy src/grimperium

[testenv:format]
description = Format code with black and ruff
skip_install = true
deps =
    ruff>=0.1.0
    black>=23.9.0
commands =
    black src/ tests/
    ruff check --fix src/ tests/

[testenv:docs]
description = Build documentation (Sphinx + API)
extras = docs
commands =
    sphinx-build -b html docs/source docs/build/html
    pdoc --html --output-dir docs/api src/grimperium

[testenv:coverage]
description = Generate coverage report
deps =
    pytest>=7.4.0
    pytest-cov>=4.1.0
commands =
    pytest tests/ --cov=src/grimperium --cov-report=html --cov-report=xml
